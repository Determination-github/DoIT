<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="fragment_nav">
<!-- 네비게이션 바-->
<nav class="navbar">

  <div class="max-width">
    <div class="logo">
      <a class="navbar-brand" th:href="@{/}">
        <img src="/img/come.png" class="logo-image" alt>
      </a>
    </div>

    <ul class="menubar">
      <th:block th:if="${session.nickName != null}">
        <li class="menu-btn-single">
          <div class="dropdown">
            <button class="bi bi-chat-square-dots dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            </button>
            <ul class="dropdown-menu alarm-msg" aria-labelledby="dropdownMenuButton1">
                <th:block th:if="${alarmList == null}">
                    <li class="empty-dropdown"><a class="dropdown-item">알림 내용이 없습니다.</a></li>
                </th:block>
                <th:block th:each="list : ${alarmList}">
                    <li><a class="dropdown-item" onclick="click_alarm(this)" th:value="${list.alarm_id}" th:href="${list.url}">[[${list.message}]]</a></li>
                </th:block>
            </ul>
          </div>
        </li>
      </th:block>

      <th:block th:if="${session.nickName != null}">
        <li class="menu-btn">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
              Study
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
              <li><a class="dropdown-item" th:href="@{/board/studyList/{id}(id = ${session.id})}">내가 쓴 글 보기</a></li>
              <li><a class="dropdown-item" th:href="@{/like/{id}(id = ${session.id})}">위시리스트</a></li>
            </ul>
          </div>
        </li>
      </th:block>
      <li class="menu-btn">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
            Mypage
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <th:block th:if="${session.nickName == null}">
              <li><a class="dropdown-item" th:href="@{/login}">로그인</a></li>
              <li><a class="dropdown-item" th:href="@{/join}">회원가입</a></li>
            </th:block>
            <th:block th:if="${session.nickName != null}">
              <li><a class="dropdown-item" th:href="@{/logout}">로그아웃</a></li>
              <li><a class="dropdown-item" th:href="@{/profile/{id}(id = ${session.id})}">내 정보보기</a></li>
              <li><a class="dropdown-item" th:href="@{/note/{id}(id = ${session.id})}">쪽지함</a></li>
            </th:block>
          </ul>
        </div>
      </li>
    </ul>

    <div class="hidden-menu-btn">
      <i class="bi bi-list"></i>
    </div>

    <input hidden id="sessionId" th:value="${session.id}"/>
  </div>

  <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/

        //알람 읽음 체크
        function click_alarm(object) {
            let id = $(object).attr('value');

            let data = {
                alarm_id : id
            }
            $.ajax({
                type:"DELETE",
                url:"/alarm/" + data.alarm_id,
                dataType : 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(data),
                cache : false,
            }).done(function() {

            }).fail(function (error) {
                alert(JSON.stringify(error));
            });
        }

        /*]]>*/
  </script>

</nav>
</div>
</body>
<th:block layout:fragment="extraJs">

</th:block>
</html>