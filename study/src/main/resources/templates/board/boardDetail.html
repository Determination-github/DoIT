<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" class="fontawesome-i2svg-active fontawesome-i2svg-complete" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}">
    <link rel="stylesheet" th:href="@{/css/page_style.css}">
    <script th:src="@{https://code.jquery.com/jquery-3.3.1.js}"></script>
    <script th:src="@{/js/bootstrap.bundle.min.js}" ></script>
    <script th:src="@{/js/page_style.js}" defer></script>
</head>
<body class="d-flex flex-column h-100">
<nav th:replace="/fragment/nav.html :: fragment_nav"></nav>
<!-------------------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------------------->
<div id="dropdown_menu_wrap" class="dropdown_menu_wrap">
    <th:block th:if="${session.nickName == null}">
        <a style="font-weight: bold;">ì•ˆë…•í•˜ì„¸ìš”, [[${session.nickName}]]ë‹˜!</a>
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-emoji-smile-fill" viewBox="0 0 16 16" style="color: #ffd400;">
            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zM4.285 9.567a.5.5 0 0 1 .683.183A3.498 3.498 0 0 0 8 11.5a3.498 3.498 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.498 4.498 0 0 1 8 12.5a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683zM10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8z"/>
        </svg>
        <dl class="dropdown_menu1">
            <dd class="nav_list_dd_border nav_list_dd_border_bottom"><a class="dropdown-item" tabindex="-1" th:href="@{/login}">ë¡œê·¸ì¸</a></dd>
            <dd class="nav_list_dd_border"><a class="dropdown-item" tabindex="-1" th:href="@{/join}">íšŒì›ê°€ì…</a></dd>
        </dl>
    </th:block>
    <th:block th:if="${session.nickName != null}">
        <dl id="dropdown_menu2" class="dropdown_menu2">
            <!-- <dt class="dropdown_menu2_title">ë§ˆì´í˜ì´ì§€</dt> -->
            <dd class="nav_list_dd_border"><a id="dropdown_menu2_mypage" class="test dropdown-item dropdown-toggle"tabindex="-1" href="javascript:">ë§ˆì´í˜ì´ì§€</a>
                <ul class="dropdown_menu2_menu">
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1">[[${session.nickName}]]ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!</a></li>
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1" th:href="@{/logout}">ë¡œê·¸ì•„ì›ƒ</a></li>
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1" href="edit.html">íšŒì› ìˆ˜ì •</a></li>
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1" href="mywrite.html">ë‚´ê°€ ì“´ ê¸€ ë³´ê¸°</a></li>
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1" href="poem.html">ìª½ì§€</a></li>
                </ul>
            </dd>
        </dl>
        <dl id="dropdown_menu3" class="dropdown_menu3">
            <!-- <dt class="dropdown_menu3_title">ìŠ¤í„°ë””</dt> -->
            <dd class="nav_list_dd_border"><a id="dropdown_menu3_study" class="test dropdown-item dropdown-toggle"tabindex="-1" href="javascript:">ìŠ¤í„°ë””</a>
                <ul class="dropdown_menu3_menu">
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1" href="wishlist.html">ì°œ ëª©ë¡</a></li>
                    <li class="nav_list_li_border"><a class="dropdown-item" tabindex="-1" href="joinstudy.html">ì°¸ì—¬í•œ ê·¸ë£¹ ë³´ê¸°</a></li>
                </ul>
            </dd>
        </dl>
    </th:block>
</div>
<!-------------------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------------------------->
<div class="pc-display-none container col-lg-10 mt-2 mb-3">
</div>
<section class="py-3">
    <div class="container col-lg-10 mt-3">
        <div class="row gx-5">
            <th:block th:if="${session.nickName} == null or ${session.id} != ${boardWriteDto.board_writerId}">
            <div class="col-lg-3">
                <div class="mobile-display-none">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center text-center">
                                <img src="/img/íŒŒë°€ë¦¬ì•„ ì„±ë‹¹.jpg" alt="ì„±ë‹¹" class="rounded-circle" width="120" height="120">
                                <div class="mt-3">
                                    <h4 class="text-break">[[${boardWriteDto.writer_nickName}]]</h4>
                                    <p class="text-secondary mb-1"></p>
                                    <a class="btn btn-primary" type="button" th:href="@{/profile/{id}(id = ${boardWriteDto.board_writerId})}">í”„ë¡œí•„ ë³´ê¸°</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </th:block>
            <div class="content-area" th:classappend="${session.id} == ${boardWriteDto.board_writerId} ? 'col-lg-12' : 'col-lg-9'">
                <article>
                    <div class="row mb-4">
                        <div class="row">
                            <div  class="col-9" style="word-break: break-word;">
                                <h1 class="fw-bolder mb-1">[[${boardWriteDto.board_title}]]</h1>
                            </div>
                            <div class="col-3 text-end pr-0">
                                <h4>
                                    <span class="badge bg-primary">ëª¨ì§‘ ì¤‘</span>
                                </h4>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="mb-2">[[${boardWriteDto.board_subTitle}]]</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-7">
                                <div class="mb-2">ëª¨ì§‘ê¸°ê°„ : [[${boardWriteDto.board_startDate}]] ~ [[${boardWriteDto.board_endDate}]]</div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-6">
                                <h5 class="d-inline">
                                    <span class="badge badge-light text-dark mr-1">#C++</span>
                                </h5>
                                <h5 class="d-inline">
                                    <span class="badge badge-light text-dark mr-1">#javascript</span>
                                </h5>
                                <h5 class="d-inline">
                                    <span class="badge badge-light text-dark mr-1">#íŒŒì´ì¬</span>
                                </h5>
                                <h5 class="d-inline">
                                    <span class="badge badge-light text-dark mr-1">#assembly</span>
                                </h5>
                                <h5 class="d-inline">
                                    <span class="badge badge-light text-dark mr-1">#OpenGL</span>
                                </h5>
                            </div>
                            <div class="col-6 text-end">
                                <th:block th:if="${session.nickName} == null or ${session.id} != ${boardWriteDto.board_writerId}">
                                    <div>
                                        <i class="bi-heart" style="font-size: 1.5rem; color: red; cursor: pointer;"></i>
                                        <button type="button" class="btn btn-primary" id="wanna-join">ğŸ™‹ ì°¸ì—¬í•˜ê³  ì‹¶ì–´ìš”</button>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <h5 class="d-inline">
                                    <span class="badge badge-info mr-1" style="background-color: blueviolet;">
                                      <i class="bi bi-geo-alt">
                                      </i>
                                      ì„œìš¸íŠ¹ë³„ì‹œ
                                    </span>
                                </h5>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-4" style="min-height: 300px;">
                        <div class="card-body" th:utext="${boardWriteDto.board_content}">
                        </div>
                    </div>
                </article>
                <section>
                    <form name="commentFrm" id="commentFrm">
                        <input type="hidden" name="totalPage" value>
                        <input type="hidden" name="page" value="0">
                    </form>
                    <div class="card bg-light">
                        <div class="card-header">
                            <h4 class="card-title">ëŒ“ê¸€</h4>
                            <input type="hidden" name="page" value="0">
                            <form name="frmComment">
                                <div class="input-group">
                                    <input type="hidden" name="parentId" value>
                                    <textarea class="form-control custom-control" id="comment" name="comment" rows="3" style="resize:none">
                                    </textarea>
                                    <button type="button" class="input-group-addon btn btn-primary" id="add-comment-btn">ì‘ì„±</button>
                                </div>
                            </form>
                        </div>
                        <div class="card-body comment-section">
                            <div class="d-flex mb-3 parent-comment boarder-bottom mb-2 pb-3">
                                <input type="hidden" value="15" name="commentId" class="comment-id">
                                <div class="flex-shrink-0">
                                    <img class="rounded-circle" src="/img/íŒŒë°€ë¦¬ì•„ ì„±ë‹¹.jpg" alt="..." width="30" height="30">
                                </div>
                                <div class="ms-3 w-100">
                                    <div class="fw-bold commenter-name">ì„±ë‹¹</div>
                                    <small class="text-muted text-sm date-panel">2022-04-19 15:32:22</small>
                                    <div class="pull-right reply-panel mr-2">
                                        <a href="#" class="reply-btn text-decoration-none">ë‹µê¸€</a>
                                    </div>
                                    <div id="commentList"></div>
                                    <div class="comment-body">ìš°ë¦¬ ìŠ¤í„°ë””ëŠ” í´ë¼ìŠ¤ê°€ ë‹¤ë¦„</div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-secondary btn-lg btn-block" type="button" id="more-comments" style="float: right;">ë”ë³´ê¸°</button>
                        </div>
                    </div>
                    <div class="siren">
                        <th:block th:if="${session.nickName} == null or ${session.id} != ${boardWriteDto.board_writerId}">
                            <button class="btn btn-secondary btn-lg btn-block mt-2" type="button" id="siren" style="float: right;">ì‹ ê³ í•˜ê¸°</button>
                        </th:block>
                        <th:block th:if="${session.id} == ${boardWriteDto.board_writerId}">
                            <a class="btn btn-secondary btn-lg btn-block mt-2" type="button" id="edit" style="float: right;" href="./groups/newedit.html">ìˆ˜ì •í•˜ê¸°</a>
                            <button class="btn btn-secondary btn-lg btn-block mt-2" type="button" id="delete" style="float: right; margin-right: 1%;">ì‚­ì œí•˜ê¸°</button>
                        </th:block>
                    </div>
                </section>
            </div>
        </div>
    </div>
</section>
</main>
<script th:inline="javascript">

    let board_Id=[[${boardWriteDto.board_Id}]];

    let toHtml = function (comments){
        let tmp = "<ul>";

        comments.forEach(function (comment){
            tmp += '<li data-comment_Id='+comment.comment_Id
            tmp += ' data-parentComment_Id='+comment.parentComment_Id
            tmp += ' data-board_Id='+comment.board_Id + '>'
        if((comment.comment_Id!=comment.parentComment_Id) && (comment.parentComment_Id>0))
            tmp += 'ã„´'
            tmp += ' ëŒ“ê¸€ ì‘ì„±ì=<span class="comment_Writer">' + comment.comment_Writer + '</span>'
            tmp += ' ëŒ“ê¸€ ë‚´ìš©=<span class="comment_Content">' + comment.comment_Content + '</span>'
            tmp += ' ì‘ì„± ì¼ì='+comment.reg_Date
            tmp += '<button class="delBtn">ì‚­ì œ</button>'
            tmp += '<button class="modBtn">ìˆ˜ì •</button>'
            tmp += '<button class="replyBtn">ë‹µê¸€</button>'
            tmp += '</li>'
        })
        return tmp + "</ul>";
    }

    let showList = function (board_Id){
        $.ajax({
            type:'GET',
            url:'/comments?board_Id='+board_Id,
            success:function (result){
                $("#commentList").html(toHtml(result));
            },
            error:function (){alert("error")}
        });
    };

    $(document).ready(function (){

        showList(board_Id);

        $("#modBtn").click(function (){
            let comment_Id = $(this).attr("data-comment_Id");
            let comment_Content = $("input[name=comment]").val();

            if(comment_Content.trim()==''){
                alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                $("input[name=comment]").focus()
                return;
            }

            $.ajax({
                type:'PATCH',
                url:'/comments/'+comment_Id,
                headers:{"content-type":"application/json"},
                data:JSON.stringify({comment_Id:comment_Id, comment_Content:comment_Content}),
                success:function (result){
                    alert(result);
                    showList(board_Id);
                },
                error:function (){alert("error")}
            })
            $("input[name=comment]").val('');
        })

        $("#wrtRepBtn").click(function (){
            let comment_Content = $("input[name=replyComment]").val();
            let parentComment_Id = $("#replyForm").parent().attr("data-comment_Id");

            if(comment_Content.trim()==''){
                alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                $("input[name=replyComment]").focus()
                return;
            }

            $.ajax({
                type:'POST',
                url:'/comments?board_Id='+board_Id,
                headers:{"content-type":"application/json"},
                data:JSON.stringify({parentComment_Id:parentComment_Id, board_Id:board_Id, comment_Content:comment_Content}),
                success:function (result){
                    alert(result);
                    showList(board_Id);
                },
                error:function (){alert("error")}
            })
            $("#replyForm").css("display", "none")
            $("input[name=replyComment]").val('')
            $("#replyForm").appendTo("body");
        })

        $("#wrtBtn").click(function (){
            let comment_Content = $("input[name=comment]").val();

                if(comment_Content.trim()==''){
                    alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    $("input[name=comment]").focus()
                    return;
                }

            $.ajax({
                type:'POST',
                url:'/comments?board_Id='+board_Id,
                headers:{"content-type":"application/json"},
                data:JSON.stringify({board_Id:board_Id, comment_Content:comment_Content}),
                success:function (result){
                    alert(result);
                    showList(board_Id);
                },
                error:function (){alert("error")}
            })
            $("input[name=comment]").val('');
        })

        $("#commentList").on("click", ".modBtn",function () {
            let comment_Id = $(this).parent().attr("data-comment_Id");
            let comment_Content = $("span.comment_Content", $(this).parent()).text();

            $("input[name=comment]").val(comment_Content);
            $("#modBtn").attr("data-comment_Id", comment_Id);
        });

        $("#commentList").on("click", ".replyBtn",function () {
            $("#replyForm").appendTo($(this).parent());
            $("#replyForm").css("display", "block");
        });
        $("#commentList").on("click", ".delBtn",function (){
            let comment_Id = $(this).parent().attr("data-comment_Id");
            let board_Id = $(this).parent().attr("data-board_Id");
            $.ajax({
                type:'DELETE',
                url:'/comments/'+comment_Id+'?board_Id='+board_Id,
                success:function (result){
                    alert(result)
                    showList(board_Id);
                },
                error:function (){alert("error")}
            });
        });

        let form= $("#form");
        let board_Title = [[${board.board_Title}]];
        let board_SubTitle = [[${board.board_SubTitle}]];
        $(document).on('click', '#deleteBtn', function (e){
            $('#form').attr("action", "remove");
            form.append("<input type='hidden' name='board_Id' value="+board_Id+">");
            form.append("<input type='hidden' name='_method' value='post'>");
            form.submit();
        })
        $(document).on('click','#updateBtn', function (e) {
            let str="<input class='form-control' width='250'" +
                "value='"+board_Title+"' id='updateBoard_Title'>";
            $("#board_Title").html(str);
            let str2="<input class='form-control' width='250" +
                "value='"+board_SubTitle+"' id='updateSubBoard_Title'>";
            $("#board_SubTitle").html(str2);
            let str3="<textarea  class='form-control' id='updateBoard_Content'></textarea>";
            $("#board_Content").html(str3);
            $("#updateBtn").attr("id", "updateConfirmBtn");
        })

        $(document).on('click','#updateConfirmBtn', function (e){
            $('#form').attr("action", "modify");
            let updateBoard_Title= $('#updateBoard_Title').val();
            let updateBoard_SubTitle= $('#updateSubBoard_Title').val();
            let updateBoard_Content= $('#updateBoard_Content').val();
            form.append("<input type='hidden' name='board_Id' value='"+board_Id+"'>");
            form.append("<input type='hidden' name='_method' value='post'>");
            form.append("<input type='hidden' name='board_Title' value='"+updateBoard_Title+"'>");
            form.append("<input type='hidden' name='board_SubTitle' value='"+updateBoard_SubTitle+"'>");
            form.append("<input type='hidden' name='board_Content' value='"+updateBoard_Content+"'>");
            form.submit();
        })
    })

</script>
</body>
</html>